# é¡¹ç›®ç»“æ„æŒ‡å—

æŒæ¡ Entity Engine é¡¹ç›®çš„æœ€ä½³ç»„ç»‡æ–¹å¼ï¼Œæ„å»ºå¯ç»´æŠ¤ã€å¯æ‰©å±•çš„ä¼ä¸šçº§åº”ç”¨æ¶æ„ã€‚

## ä¸ºä»€ä¹ˆç»“æ„å¾ˆé‡è¦

è‰¯å¥½çš„é¡¹ç›®ç»“æ„èƒ½å¤Ÿï¼š

- **æå‡å¼€å‘æ•ˆç‡** - å›¢é˜Ÿæˆå‘˜èƒ½å¿«é€Ÿæ‰¾åˆ°å’Œä¿®æ”¹ä»£ç 
- **é™ä½ç»´æŠ¤æˆæœ¬** - æ¸…æ™°çš„èŒè´£åˆ†ç¦»è®©ä»£ç æ›´æ˜“ç†è§£å’Œä¿®æ”¹  
- **æ”¯æŒé¡¹ç›®æ‰©å±•** - æ¨¡å—åŒ–è®¾è®¡è®©åŠŸèƒ½æ‰©å±•æ›´åŠ å®¹æ˜“
- **ä¿ƒè¿›å›¢é˜Ÿåä½œ** - æ ‡å‡†åŒ–çš„ç»“æ„å‡å°‘æ²Ÿé€šæˆæœ¬

## æ ¸å¿ƒè®¾è®¡åŸåˆ™

Entity Engine çš„é¡¹ç›®ç»“æ„éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š

- **å…³æ³¨ç‚¹åˆ†ç¦»** - æ•°æ®æ¨¡å‹ã€è§†å›¾é…ç½®ã€ä¸šåŠ¡é€»è¾‘åˆ†åˆ«ç®¡ç†
- **çº¦å®šä¼˜äºé…ç½®** - éµå¾ªçº¦å®šçš„ç›®å½•ç»“æ„å‡å°‘é…ç½®å·¥ä½œ
- **æ¨¡å—åŒ–ç»„ç»‡** - æ”¯æŒä»å°å‹é¡¹ç›®åˆ°å¤§å‹ä¼ä¸šåº”ç”¨çš„æ¸è¿›å¼å‘å±•

## åŸºç¡€é¡¹ç›®ç»“æ„

é€‚åˆä¸­å°å‹é¡¹ç›®çš„æ ‡å‡†ç»„ç»‡æ–¹å¼ï¼š

```
my-entity-app/
â”œâ”€â”€ lib/                    # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ models.ts          # ğŸ“Š æ•°æ®æ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ views.ts           # ğŸ¨ UI è§†å›¾é…ç½®
â”‚   â””â”€â”€ entity-provider.tsx # âš™ï¸ å®¢æˆ·ç«¯é…ç½®
â”œâ”€â”€ app/                    # Next.js åº”ç”¨ç›®å½•
â”‚   â”œâ”€â”€ api/ee/[[...slug]]/
â”‚   â”‚   â””â”€â”€ route.ts       # ğŸ”Œ API å¤„ç†å™¨
â”‚   â”œâ”€â”€ products/
â”‚   â”‚   â””â”€â”€ page.tsx       # ğŸ“„ ä¸šåŠ¡é¡µé¢
â”‚   â””â”€â”€ layout.tsx         # ğŸ–¼ï¸ åº”ç”¨å¸ƒå±€
â”œâ”€â”€ prisma/
â”‚   â””â”€â”€ schema.prisma      # ğŸ—„ï¸ æ•°æ®åº“ç»“æ„
â””â”€â”€ .env.local             # ğŸ” ç¯å¢ƒé…ç½®
```

## æ ¸å¿ƒæ–‡ä»¶è¯¦è§£

### æ¨¡å‹å®šä¹‰ (`lib/models.ts`)

é›†ä¸­ç®¡ç†æ‰€æœ‰æ•°æ®æ¨¡å‹ï¼š

```typescript filename="lib/models.ts"
import type { IEntityModel } from '@scenemesh/entity-engine';

export const UserModel: IEntityModel = {
  name: 'User',
  title: 'ç”¨æˆ·',
  fields: [
    {
      name: 'id',
      title: 'ID',
      type: 'string',
      isPrimaryKey: true,
    },
    {
      name: 'name',
      title: 'å§“å',
      type: 'string',
      isRequired: true,
      searchable: true,
    },
    {
      name: 'email',
      title: 'é‚®ç®±',
      type: 'string',
      isRequired: true,
      isUnique: true,
    }
  ]
};

export const ProductModel: IEntityModel = {
  name: 'Product',
  title: 'äº§å“',
  fields: [
    {
      name: 'id',
      title: 'ID',
      type: 'string',
      isPrimaryKey: true,
    },
    {
      name: 'name',
      title: 'äº§å“åç§°',
      type: 'string',
      isRequired: true,
      searchable: true,
    },
    {
      name: 'price',
      title: 'ä»·æ ¼',
      type: 'number',
      isRequired: true,
    },
    {
      name: 'user',
      title: 'åˆ›å»ºè€…',
      type: 'many_to_one',
      refModel: 'User',
    }
  ]
};

// å¯¼å‡ºæ‰€æœ‰æ¨¡å‹
export const models = [UserModel, ProductModel];
```

### è§†å›¾é…ç½® (`lib/views.ts`)

å®šä¹‰ç”¨æˆ·ç•Œé¢å¸ƒå±€ï¼š

```typescript filename="lib/views.ts"
import type { IEntityView } from '@scenemesh/entity-engine';

export const UserGridView: IEntityView = {
  name: 'user_grid',
  title: 'ç”¨æˆ·åˆ—è¡¨',
  modelName: 'User',
  viewType: 'grid',
  items: [
    { type: 'field', name: 'name', spanCols: 4 },
    { type: 'field', name: 'email', spanCols: 8 },
  ]
};

export const UserFormView: IEntityView = {
  name: 'user_form',
  title: 'ç”¨æˆ·è¡¨å•',
  modelName: 'User',
  viewType: 'form',
  items: [
    { type: 'field', name: 'name' },
    { type: 'field', name: 'email' },
  ]
};

export const ProductGridView: IEntityView = {
  name: 'product_grid',
  title: 'äº§å“åˆ—è¡¨',
  modelName: 'Product',
  viewType: 'grid',
  items: [
    { type: 'field', name: 'name', spanCols: 4 },
    { type: 'field', name: 'price', spanCols: 2 },
    { type: 'field', name: 'user', spanCols: 6 },
  ]
};

export const ProductFormView: IEntityView = {
  name: 'product_form',
  title: 'äº§å“è¡¨å•',
  modelName: 'Product',
  viewType: 'form',
  items: [
    { type: 'field', name: 'name' },
    { type: 'field', name: 'price' },
    { type: 'field', name: 'user' },
  ]
};

// å¯¼å‡ºæ‰€æœ‰è§†å›¾
export const views = [
  UserGridView,
  UserFormView,
  ProductGridView,
  ProductFormView,
];
```

### å®¢æˆ·ç«¯ Provider (`lib/entity-provider.tsx`)

é…ç½®å®¢æˆ·ç«¯ Entity Engineï¼š

```tsx filename="lib/entity-provider.tsx"
'use client';
import { createEntityEngineProvider } from '@scenemesh/entity-engine';
import { models } from './models';
import { views } from './views';

export const EntityEngineProvider = createEntityEngineProvider({
  config: { models, views },
  settings: {
    baseUrl: process.env.NEXT_PUBLIC_API_BASE_URL || '',
    endpoint: '/api/ee',
    authenticationEnabled: false,
  },
  router: {
    navigate: (path: string) => {
      if (typeof window !== 'undefined') {
        window.location.href = path;
      }
    }
  },
  permissionGuard: {
    checkPermission: async () => true,
  },
});
```

### API è·¯ç”± (`app/api/ee/[[...slug]]/route.ts`)

æœåŠ¡ç«¯ API å¤„ç†å™¨ï¼š

```typescript filename="app/api/ee/[[...slug]]/route.ts"
import { EnginePrimitiveInitializer, fetchEntityEntranceHandler } from '@scenemesh/entity-engine/server';
import { models } from '../../../../lib/models';
import { views } from '../../../../lib/views';

const initializer = new EnginePrimitiveInitializer({
  models,
  views,
});

const handler = (req: Request) => 
  fetchEntityEntranceHandler({
    request: req,
    endpoint: '/api/ee',
    initializer
  });

export { handler as GET, handler as POST };
```

## å¤§å‹é¡¹ç›®ç»“æ„

å¯¹äºå¤æ‚åº”ç”¨ï¼Œæ¨èä½¿ç”¨æ¨¡å—åŒ–ç»“æ„ï¼š

```
src/
â”œâ”€â”€ entities/
â”‚   â”œâ”€â”€ user/
â”‚   â”‚   â”œâ”€â”€ models.ts
â”‚   â”‚   â”œâ”€â”€ views.ts
â”‚   â”‚   â””â”€â”€ components.tsx
â”‚   â”œâ”€â”€ product/
â”‚   â”‚   â”œâ”€â”€ models.ts
â”‚   â”‚   â”œâ”€â”€ views.ts
â”‚   â”‚   â””â”€â”€ components.tsx
â”‚   â””â”€â”€ order/
â”‚       â”œâ”€â”€ models.ts
â”‚       â”œâ”€â”€ views.ts
â”‚       â””â”€â”€ components.tsx
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ entity-registry.ts  # ç»Ÿä¸€æ³¨å†Œ
â”‚   â””â”€â”€ entity-provider.tsx
â””â”€â”€ app/
    â”œâ”€â”€ api/ee/[[...slug]]/route.ts
    â””â”€â”€ (business modules)/
```

### æ¨¡å—åŒ–æ³¨å†Œ (`lib/entity-registry.ts`)

ç»Ÿä¸€ç®¡ç†æ‰€æœ‰å®ä½“ï¼š

```typescript filename="lib/entity-registry.ts"
import { models as userModels, views as userViews } from '../entities/user';
import { models as productModels, views as productViews } from '../entities/product';
import { models as orderModels, views as orderViews } from '../entities/order';

export const allModels = [
  ...userModels,
  ...productModels,
  ...orderModels,
];

export const allViews = [
  ...userViews,
  ...productViews,
  ...orderViews,
];
```

### å•ä¸ªå®ä½“æ¨¡å— (`entities/user/models.ts`)

```typescript filename="entities/user/models.ts"
import type { IEntityModel } from '@scenemesh/entity-engine';
import { z } from 'zod';

export const UserModel: IEntityModel = {
  name: 'User',
  title: 'ç”¨æˆ·',
  fields: [
    {
      name: 'id',
      title: 'ID',
      type: 'string',
      isPrimaryKey: true,
    },
    {
      name: 'name',
      title: 'å§“å',
      type: 'string',
      isRequired: true,
      searchable: true,
      schema: z.string().min(2, 'å§“åè‡³å°‘2ä¸ªå­—ç¬¦').max(50, 'å§“åæœ€å¤š50ä¸ªå­—ç¬¦'),
    },
    {
      name: 'email',
      title: 'é‚®ç®±',
      type: 'string',
      isRequired: true,
      isUnique: true,
      schema: z.string().email('è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€'),
    },
    {
      name: 'role',
      title: 'è§’è‰²',
      type: 'enum',
      defaultValue: 'user',
      typeOptions: {
        options: [
          { value: 'admin', label: 'ç®¡ç†å‘˜' },
          { value: 'user', label: 'æ™®é€šç”¨æˆ·' },
        ]
      }
    }
  ]
};

export const models = [UserModel];
```

## ç¯å¢ƒé…ç½®

### ç¯å¢ƒå˜é‡ (`.env.local`)

```env filename=".env.local"
# Entity Engine æ•°æ®åº“
EE_DATABASE_URL="postgresql://user:password@localhost:5432/myapp?schema=public"

# API é…ç½®
NEXT_PUBLIC_API_BASE_URL=""
NEXT_PUBLIC_API_ENDPOINT="/api/ee"

# å¯é€‰ï¼šå¼€å‘æ¨¡å¼é…ç½®
NODE_ENV="development"
ENTITY_ENGINE_DEBUG="true"
```

### TypeScript é…ç½® (`tsconfig.json`)

```json filename="tsconfig.json" highlight="6-9"
{
  "compilerOptions": {
    "target": "ES2022",
    "lib": ["dom", "dom.iterable", "es6"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "forceConsistentCasingInFileNames": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"],
      "@/lib/*": ["./lib/*"],
      "@/entities/*": ["./entities/*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}
```

## æœ€ä½³å®è·µ

### å‘½åçº¦å®š

- **æ¨¡å‹åç§°**: ä½¿ç”¨ PascalCase (`UserModel`, `ProductModel`)
- **è§†å›¾åç§°**: ä½¿ç”¨ snake_case (`user_grid`, `product_form`)  
- **æ–‡ä»¶å**: ä½¿ç”¨ kebab-case (`user-profile.tsx`, `order-history.tsx`)

### ä»£ç ç»„ç»‡

- **å…³æ³¨ç‚¹åˆ†ç¦»**: æ¨¡å‹ã€è§†å›¾ã€ç»„ä»¶åˆ†åˆ«ç®¡ç†
- **å•ä¸€èŒè´£**: æ¯ä¸ªæ–‡ä»¶åªè´Ÿè´£ä¸€ä¸ªå®ä½“æˆ–åŠŸèƒ½
- **å¯¼å…¥é¡ºåº**: ç¬¬ä¸‰æ–¹åº“ â†’ æœ¬åœ°åº“ â†’ ç›¸å¯¹å¯¼å…¥

### æ€§èƒ½ä¼˜åŒ–

- **å»¶è¿ŸåŠ è½½**: å¤§å‹æ¨¡å—ä½¿ç”¨åŠ¨æ€å¯¼å…¥
- **ç¼“å­˜ç­–ç•¥**: åˆç†ä½¿ç”¨ React ç¼“å­˜æœºåˆ¶
- **æ•°æ®åˆ†é¡µ**: å¤§æ•°æ®é›†å¯ç”¨åˆ†é¡µæŸ¥è¯¢

## éƒ¨ç½²ç»“æ„

### ç”Ÿäº§ç¯å¢ƒç›®å½•

```
production/
â”œâ”€â”€ .next/                # Next.js æ„å»ºè¾“å‡º
â”œâ”€â”€ prisma/
â”‚   â”œâ”€â”€ schema.prisma
â”‚   â””â”€â”€ migrations/
â”œâ”€â”€ public/
â”œâ”€â”€ package.json
â””â”€â”€ .env.production       # ç”Ÿäº§ç¯å¢ƒå˜é‡
```

### Docker é…ç½®ç¤ºä¾‹

```dockerfile filename="Dockerfile"
FROM node:18-alpine

WORKDIR /app

# å¤åˆ¶ä¾èµ–æ–‡ä»¶
COPY package*.json ./
COPY prisma ./prisma/

# å®‰è£…ä¾èµ–
RUN npm ci --only=production

# å¤åˆ¶æºä»£ç 
COPY . .

# æ„å»ºåº”ç”¨
RUN npm run build

# ç”Ÿæˆ Prisma Client
RUN npx prisma generate

EXPOSE 3000

CMD ["npm", "start"]
```

## ä¸‹ä¸€æ­¥

- [æ„å»ºç¬¬ä¸€ä¸ªå®Œæ•´åŠŸèƒ½](./first-model-and-view) - å®æˆ˜æ¼”ç»ƒ
- [é«˜çº§é…ç½®ç®¡ç†](./config-runtime-load) - åŠ¨æ€é…ç½®
- [å¸¸è§é—®é¢˜è§£ç­”](./faq-beginner) - æ•…éšœæ’é™¤