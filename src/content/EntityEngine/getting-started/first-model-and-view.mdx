# ç¬¬ä¸€ä¸ªå®Œæ•´åº”ç”¨

æ„å»ºä¸€ä¸ªäº§å“ç®¡ç†ç³»ç»Ÿï¼Œå­¦ä¹  Entity Engine çš„æ¨¡å‹å®šä¹‰ã€è§†å›¾é…ç½®å’Œå…³è”å…³ç³»ã€‚

## æˆ‘ä»¬å°†æ„å»ºä»€ä¹ˆ

ä¸€ä¸ªåŒ…å«äº§å“å’Œåˆ†ç±»ç®¡ç†çš„å®Œæ•´åº”ç”¨ï¼š

- ğŸ“¦ **äº§å“ç®¡ç†** - åˆ›å»ºã€ç¼–è¾‘ã€æŸ¥çœ‹äº§å“
- ğŸ“‚ **åˆ†ç±»ç®¡ç†** - ç»„ç»‡äº§å“åˆ†ç±»å±‚çº§ 
- ğŸ”— **å…³è”å…³ç³»** - äº§å“å±äºåˆ†ç±»
- âœ… **æ•°æ®éªŒè¯** - è¡¨å•éªŒè¯å’Œä¸šåŠ¡è§„åˆ™

## ç¬¬ä¸€æ­¥ï¼šå®šä¹‰åˆ†ç±»æ¨¡å‹

å…ˆåˆ›å»ºåˆ†ç±»æ¨¡å‹ï¼Œå› ä¸ºäº§å“ä¼šå¼•ç”¨åˆ†ç±»ã€‚

åˆ›å»º `lib/models.ts`ï¼š

```typescript filename="lib/models.ts"
import type { IEntityModel } from '@scenemesh/entity-engine';
import { z } from 'zod';

export const CategoryModel: IEntityModel = {
  name: 'Category',
  title: 'äº§å“åˆ†ç±»',
  fields: [
    {
      name: 'id',
      title: 'ID',
      type: 'string',
      isPrimaryKey: true,
    },
    {
      name: 'name',
      title: 'åˆ†ç±»åç§°',
      type: 'string',
      isRequired: true,
      searchable: true,
      schema: z.string().min(1, 'åˆ†ç±»åç§°ä¸èƒ½ä¸ºç©º').max(50, 'åˆ†ç±»åç§°ä¸èƒ½è¶…è¿‡50ä¸ªå­—ç¬¦')
    },
    {
      name: 'description',
      title: 'åˆ†ç±»æè¿°',
      type: 'string',
      schema: z.string().max(200, 'æè¿°ä¸èƒ½è¶…è¿‡200ä¸ªå­—ç¬¦').optional()
    }
  ]
};

export const models = [CategoryModel];
```

## ç¬¬äºŒæ­¥ï¼šæ·»åŠ äº§å“æ¨¡å‹

ç°åœ¨æ·»åŠ äº§å“æ¨¡å‹å¹¶å»ºç«‹ä¸åˆ†ç±»çš„å…³è”ï¼š

```typescript filename="lib/models.ts" highlight="2,29-72"
import type { IEntityModel } from '@scenemesh/entity-engine';
import { z } from 'zod';

export const CategoryModel: IEntityModel = {
  name: 'Category',
  title: 'äº§å“åˆ†ç±»',
  fields: [
    {
      name: 'id',
      title: 'ID',
      type: 'string',
      isPrimaryKey: true,
    },
    {
      name: 'name',
      title: 'åˆ†ç±»åç§°',
      type: 'string',
      isRequired: true,
      searchable: true,
      schema: z.string().min(1, 'åˆ†ç±»åç§°ä¸èƒ½ä¸ºç©º').max(50, 'åˆ†ç±»åç§°ä¸èƒ½è¶…è¿‡50ä¸ªå­—ç¬¦')
    },
    {
      name: 'description',
      title: 'åˆ†ç±»æè¿°',
      type: 'string',
      schema: z.string().max(200, 'æè¿°ä¸èƒ½è¶…è¿‡200ä¸ªå­—ç¬¦').optional()
    }
  ]
};

export const ProductModel: IEntityModel = {
  name: 'Product',
  title: 'äº§å“',
  fields: [
    {
      name: 'id',
      title: 'ID',
      type: 'string',
      isPrimaryKey: true,
    },
    {
      name: 'name',
      title: 'äº§å“åç§°',
      type: 'string',
      isRequired: true,
      searchable: true,
      schema: z.string().min(2, 'äº§å“åç§°è‡³å°‘2ä¸ªå­—ç¬¦').max(100, 'äº§å“åç§°æœ€å¤š100ä¸ªå­—ç¬¦')
    },
    {
      name: 'sku',
      title: 'SKUç¼–ç ',
      type: 'string',
      isRequired: true,
      isUnique: true,
      searchable: true,
      schema: z.string().regex(/^[A-Z0-9-]+$/, 'SKUåªèƒ½åŒ…å«å¤§å†™å­—æ¯ã€æ•°å­—å’Œè¿å­—ç¬¦').min(3, 'SKUè‡³å°‘3ä¸ªå­—ç¬¦')
    },
    {
      name: 'price',
      title: 'ä»·æ ¼',
      type: 'number',
      isRequired: true,
      schema: z.number().min(0, 'ä»·æ ¼ä¸èƒ½ä¸ºè´Ÿæ•°').max(999999.99, 'ä»·æ ¼ä¸èƒ½è¶…è¿‡999999.99')
    },
    {
      name: 'description',
      title: 'äº§å“æè¿°',
      type: 'string',
      schema: z.string().max(1000, 'æè¿°æœ€å¤š1000ä¸ªå­—ç¬¦').optional()
    },
    {
      name: 'category',
      title: 'äº§å“åˆ†ç±»',
      type: 'many_to_one',
      refModel: 'Category',
      isRequired: true
    }
  ]
};

// æ³¨æ„ï¼šè¢«å¼•ç”¨çš„æ¨¡å‹è¦å…ˆæ³¨å†Œ
export const models = [CategoryModel, ProductModel];
```

## ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºè§†å›¾

å®šä¹‰ç”¨æˆ·ç•Œé¢å¸ƒå±€ã€‚åˆ›å»º `lib/views.ts`ï¼š

```typescript filename="lib/views.ts"
import type { IEntityView } from '@scenemesh/entity-engine';

// åˆ†ç±»è§†å›¾
export const CategoryGridView: IEntityView = {
  name: 'category_grid',
  title: 'åˆ†ç±»åˆ—è¡¨',
  modelName: 'Category',
  viewType: 'grid',
  items: [
    {
      type: 'field',
      name: 'name',
      spanCols: 4,
    },
    {
      type: 'field',
      name: 'description',
      spanCols: 8,
    }
  ]
};

export const CategoryFormView: IEntityView = {
  name: 'category_form',
  title: 'åˆ†ç±»è¡¨å•',
  modelName: 'Category',
  viewType: 'form',
  items: [
    {
      type: 'field',
      name: 'name',
    },
    {
      type: 'field',
      name: 'description',
    }
  ]
};

// äº§å“è§†å›¾
export const ProductGridView: IEntityView = {
  name: 'product_grid',
  title: 'äº§å“åˆ—è¡¨',
  modelName: 'Product',
  viewType: 'grid',
  items: [
    {
      type: 'field',
      name: 'name',
      spanCols: 3,
    },
    {
      type: 'field',
      name: 'sku',
      spanCols: 2,
    },
    {
      type: 'field',
      name: 'price',
      spanCols: 2,
    },
    {
      type: 'field',
      name: 'category',
      spanCols: 3,
    }
  ]
};

export const ProductFormView: IEntityView = {
  name: 'product_form',
  title: 'äº§å“è¡¨å•',
  modelName: 'Product',
  viewType: 'form',
  items: [
    {
      type: 'panel',
      title: 'åŸºæœ¬ä¿¡æ¯',
      items: [
        {
          type: 'field',
          name: 'name',
        },
        {
          type: 'field',
          name: 'sku',
        },
        {
          type: 'field',
          name: 'category',
        },
        {
          type: 'field',
          name: 'price',
        }
      ]
    },
    {
      type: 'panel',
      title: 'è¯¦ç»†ä¿¡æ¯',
      items: [
        {
          type: 'field',
          name: 'description',
        }
      ]
    }
  ]
};

export const views = [
  CategoryGridView,
  CategoryFormView,
  ProductGridView,
  ProductFormView,
];
```

## ç¬¬å››æ­¥ï¼šè®¾ç½® API å’Œ Provider

åˆ›å»ºæœåŠ¡ç«¯é…ç½®ã€‚åˆ›å»º `app/api/ee/[[...slug]]/route.ts`ï¼š

```typescript filename="app/api/ee/[[...slug]]/route.ts"
import { EnginePrimitiveInitializer, fetchEntityEntranceHandler } from '@scenemesh/entity-engine/server';
import { models } from '../../../../lib/models';
import { views } from '../../../../lib/views';

const initializer = new EnginePrimitiveInitializer({
  models,
  views,
});

const handler = (req: Request) => 
  fetchEntityEntranceHandler({
    request: req,
    endpoint: '/api/ee',
    initializer
  });

export { handler as GET, handler as POST };
```

åˆ›å»ºå®¢æˆ·ç«¯ Providerã€‚åˆ›å»º `lib/entity-provider.tsx`ï¼š

```tsx filename="lib/entity-provider.tsx"
'use client';
import { createEntityEngineProvider } from '@scenemesh/entity-engine';
import { models } from './models';
import { views } from './views';

export const EntityEngineProvider = createEntityEngineProvider({
  config: { models, views },
  settings: {
    baseUrl: process.env.NEXT_PUBLIC_API_BASE_URL || '',
    endpoint: '/api/ee',
    authenticationEnabled: false,
  },
  router: {
    navigate: (path: string) => {
      if (typeof window !== 'undefined') {
        window.location.href = path;
      }
    }
  },
  permissionGuard: {
    checkPermission: async () => true,
  },
});
```

## ç¬¬äº”æ­¥ï¼šæ„å»ºç”¨æˆ·ç•Œé¢

åˆ›å»ºäº§å“ç®¡ç†é¡µé¢ã€‚åˆ›å»º `app/products/page.tsx`ï¼š

```tsx filename="app/products/page.tsx"
'use client';
import { EntityViewContainer } from '@scenemesh/entity-engine';
import { EntityEngineProvider } from '../../lib/entity-provider';
import { useState } from 'react';
import Link from 'next/link';

function ProductManagement() {
  const [refreshKey, setRefreshKey] = useState(0);

  return (
    <div className="min-h-screen bg-gray-50">
      <div className="container mx-auto py-8">
        {/* é¡µé¢å¤´éƒ¨ */}
        <div className="bg-white rounded-lg shadow-sm p-6 mb-6">
          <div className="flex justify-between items-center">
            <div>
              <h1 className="text-3xl font-bold text-gray-900">äº§å“ç®¡ç†</h1>
              <p className="text-gray-600 mt-2">ç®¡ç†æ‚¨çš„äº§å“åº“å­˜å’Œä¿¡æ¯</p>
            </div>
            <div className="flex gap-3">
              <Link 
                href="/categories"
                className="px-4 py-2 text-blue-600 border border-blue-600 rounded-lg hover:bg-blue-50"
              >
                ç®¡ç†åˆ†ç±»
              </Link>
              <Link 
                href="/products/new"
                className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
              >
                æ–°å¢äº§å“
              </Link>
            </div>
          </div>
        </div>

        {/* äº§å“åˆ—è¡¨ */}
        <div className="bg-white rounded-lg shadow-sm">
          <EntityViewContainer
            key={refreshKey}
            modelName="Product"
            viewType="grid"
            viewName="product_grid"
            behavior={{ 
              mode: 'display' 
            }}
            callbacks={{
              onSaved: () => setRefreshKey(prev => prev + 1),
              onDeleted: () => setRefreshKey(prev => prev + 1)
            }}
          />
        </div>
      </div>
    </div>
  );
}

export default function ProductsPage() {
  return (
    <EntityEngineProvider>
      <ProductManagement />
    </EntityEngineProvider>
  );
}
```

åˆ›å»ºæ–°å¢äº§å“é¡µé¢ã€‚åˆ›å»º `app/products/new/page.tsx`ï¼š

```tsx filename="app/products/new/page.tsx"
'use client';
import { EntityViewContainer } from '@scenemesh/entity-engine';
import { EntityEngineProvider } from '../../../lib/entity-provider';
import { useRouter } from 'next/navigation';

function NewProductForm() {
  const router = useRouter();

  return (
    <div className="min-h-screen bg-gray-50">
      <div className="container mx-auto py-8">
        <div className="max-w-4xl mx-auto">
          {/* é¡µé¢å¤´éƒ¨ */}
          <div className="bg-white rounded-lg shadow-sm p-6 mb-6">
            <div className="flex justify-between items-center">
              <div>
                <h1 className="text-3xl font-bold text-gray-900">æ–°å¢äº§å“</h1>
                <p className="text-gray-600 mt-2">æ·»åŠ æ–°çš„äº§å“åˆ°æ‚¨çš„åº“å­˜ä¸­</p>
              </div>
              <button
                onClick={() => router.back()}
                className="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50"
              >
                è¿”å›
              </button>
            </div>
          </div>

          {/* äº§å“è¡¨å• */}
          <div className="bg-white rounded-lg shadow-sm p-6">
            <EntityViewContainer
              modelName="Product"
              viewType="form"
              viewName="product_form"
              behavior={{ 
                mode: 'edit'
              }}
              callbacks={{
                onSaved: () => {
                  router.push('/products');
                },
                onCancelled: () => {
                  router.push('/products');
                }
              }}
            />
          </div>
        </div>
      </div>
    </div>
  );
}

export default function NewProductPage() {
  return (
    <EntityEngineProvider>
      <NewProductForm />
    </EntityEngineProvider>
  );
}
```

åˆ›å»ºåˆ†ç±»ç®¡ç†é¡µé¢ã€‚åˆ›å»º `app/categories/page.tsx`ï¼š

```tsx filename="app/categories/page.tsx"
'use client';
import { EntityViewContainer } from '@scenemesh/entity-engine';
import { EntityEngineProvider } from '../../lib/entity-provider';
import { useState } from 'react';

function CategoryManagement() {
  const [showForm, setShowForm] = useState(false);
  const [refreshKey, setRefreshKey] = useState(0);

  return (
    <div className="min-h-screen bg-gray-50">
      <div className="container mx-auto py-8">
        {/* é¡µé¢å¤´éƒ¨ */}
        <div className="bg-white rounded-lg shadow-sm p-6 mb-6">
          <div className="flex justify-between items-center">
            <div>
              <h1 className="text-3xl font-bold text-gray-900">åˆ†ç±»ç®¡ç†</h1>
              <p className="text-gray-600 mt-2">ç»„ç»‡æ‚¨çš„äº§å“åˆ†ç±»ç»“æ„</p>
            </div>
            <button
              onClick={() => setShowForm(true)}
              className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
            >
              æ–°å¢åˆ†ç±»
            </button>
          </div>
        </div>

        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
          {/* åˆ†ç±»åˆ—è¡¨ */}
          <div className="lg:col-span-2">
            <div className="bg-white rounded-lg shadow-sm">
              <EntityViewContainer
                key={refreshKey}
                modelName="Category"
                viewType="grid"
                viewName="category_grid"
                behavior={{ mode: 'display' }}
              />
            </div>
          </div>
          
          {/* æ–°å¢è¡¨å• */}
          {showForm && (
            <div className="lg:col-span-1">
              <div className="bg-white rounded-lg shadow-sm p-6">
                <div className="flex justify-between items-center mb-4">
                  <h2 className="text-xl font-semibold">æ–°å¢åˆ†ç±»</h2>
                  <button
                    onClick={() => setShowForm(false)}
                    className="text-gray-500 hover:text-gray-700"
                  >
                    âœ•
                  </button>
                </div>
                
                <EntityViewContainer
                  modelName="Category"
                  viewType="form"
                  viewName="category_form"
                  behavior={{ mode: 'edit' }}
                  callbacks={{
                    onSaved: () => {
                      setShowForm(false);
                      setRefreshKey(prev => prev + 1);
                    },
                    onCancelled: () => {
                      setShowForm(false);
                    }
                  }}
                />
              </div>
            </div>
          )}
        </div>
      </div>
    </div>
  );
}

export default function CategoriesPage() {
  return (
    <EntityEngineProvider>
      <CategoryManagement />
    </EntityEngineProvider>
  );
}
```

## ç¬¬å…­æ­¥ï¼šé…ç½®æ ·å¼å’Œå¸ƒå±€

æ›´æ–°æ ¹å¸ƒå±€ã€‚ä¿®æ”¹ `app/layout.tsx`ï¼š

```tsx filename="app/layout.tsx"
import '@scenemesh/entity-engine/main.css';
import '@mantine/core/styles.css';
import '@mantine/notifications/styles.css';
import '@mantine/modals/styles.css';
import 'mantine-datatable/styles.css';
import { MantineProvider } from '@mantine/core';
import { Notifications } from '@mantine/notifications';

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="zh">
      <body>
        <MantineProvider>
          <Notifications />
          {children}
        </MantineProvider>
      </body>
    </html>
  );
}
```

## è¿è¡Œåº”ç”¨

å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼š

```bash
npm run dev
```

ç°åœ¨æ‚¨å¯ä»¥è®¿é—®ï¼š

- http://localhost:3000/categories - åˆ†ç±»ç®¡ç†
- http://localhost:3000/products - äº§å“ç®¡ç†
- http://localhost:3000/products/new - æ–°å¢äº§å“

## æµ‹è¯•å®Œæ•´åŠŸèƒ½

éªŒè¯ä»¥ä¸‹åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œï¼š

### åˆ†ç±»ç®¡ç†
- âœ… åˆ›å»ºæ–°åˆ†ç±»
- âœ… æŸ¥çœ‹åˆ†ç±»åˆ—è¡¨
- âœ… è¡¨å•éªŒè¯ï¼ˆåç§°å¿…å¡«ï¼‰

### äº§å“ç®¡ç†  
- âœ… åˆ›å»ºæ–°äº§å“å¹¶é€‰æ‹©åˆ†ç±»
- âœ… æŸ¥çœ‹äº§å“åˆ—è¡¨ï¼ˆæ˜¾ç¤ºå…³è”åˆ†ç±»ï¼‰
- âœ… SKUå”¯ä¸€æ€§éªŒè¯
- âœ… ä»·æ ¼æ ¼å¼éªŒè¯

### å…³è”å…³ç³»
- âœ… äº§å“è¡¨å•æ˜¾ç¤ºåˆ†ç±»é€‰æ‹©å™¨
- âœ… äº§å“åˆ—è¡¨æ˜¾ç¤ºåˆ†ç±»åç§°
- âœ… åˆ†ç±»åˆ é™¤å‰æ£€æŸ¥æ˜¯å¦æœ‰äº§å“ä½¿ç”¨

## æ‰©å±•åŠŸèƒ½

### æ·»åŠ æ›´å¤šå­—æ®µ

ä¸ºäº§å“æ¨¡å‹æ·»åŠ çŠ¶æ€å’Œæ ‡ç­¾ï¼š

```typescript filename="lib/models.ts" highlight="4-19"
// åœ¨ ProductModel çš„ fields æ•°ç»„ä¸­æ·»åŠ 
{
  name: 'status',
  title: 'çŠ¶æ€',
  type: 'enum',
  defaultValue: 'draft',
  typeOptions: {
    options: [
      { value: 'draft', label: 'è‰ç¨¿' },
      { value: 'published', label: 'å·²å‘å¸ƒ' },
      { value: 'discontinued', label: 'å·²åœäº§' }
    ]
  }
},
{
  name: 'tags',
  title: 'æ ‡ç­¾',
  type: 'array',
  typeOptions: {
    itemType: 'string'
  }
}
```

### æ·»åŠ æœç´¢å’Œç­›é€‰

æ›´æ–°äº§å“è§†å›¾ä»¥æ”¯æŒæœç´¢ï¼š

```typescript filename="lib/views.ts" highlight="6-8"
export const ProductGridView: IEntityView = {
  name: 'product_grid',
  title: 'äº§å“åˆ—è¡¨',
  modelName: 'Product',
  viewType: 'grid',
  searchFields: ['name', 'sku', 'description'],
  filters: ['category', 'status'],
  sorting: { field: 'name', direction: 'asc' },
  items: [
    // ... ç°æœ‰é…ç½®
  ]
};
```

## ä¸‹ä¸€æ­¥

ğŸ‰ æ­å–œï¼æ‚¨å·²ç»æ„å»ºäº†ä¸€ä¸ªå®Œæ•´çš„äº§å“ç®¡ç†åº”ç”¨ã€‚ç°åœ¨å¯ä»¥ï¼š

- [å­¦ä¹ é«˜çº§é…ç½®](./config-runtime-load) - æ¢ç´¢åŠ¨æ€é…ç½®ç®¡ç†
- [æŸ¥çœ‹é¡¹ç›®ç»“æ„](./project-structure) - äº†è§£æœ€ä½³å®è·µ
- [è§£å†³é—®é¢˜](./faq-beginner) - å¸¸è§é—®é¢˜è§£ç­”

## æ ¸å¿ƒæ¦‚å¿µæ€»ç»“

é€šè¿‡è¿™ä¸ªæ•™ç¨‹ï¼Œæ‚¨å­¦ä¼šäº†ï¼š

- **æ¨¡å‹å…³è”**: ä½¿ç”¨ `many_to_one` å»ºç«‹å¤–é”®å…³ç³»
- **æ•°æ®éªŒè¯**: ä½¿ç”¨ Zod schema ç¡®ä¿æ•°æ®è´¨é‡
- **è§†å›¾é…ç½®**: åˆ›å»ºåˆ—è¡¨å’Œè¡¨å•ç•Œé¢
- **ç»„ä»¶ä½¿ç”¨**: ä½¿ç”¨ EntityViewContainer æ˜¾ç¤ºæ•°æ®
- **çŠ¶æ€ç®¡ç†**: å¤„ç†è¡¨å•å›è°ƒå’Œæ•°æ®åˆ·æ–°