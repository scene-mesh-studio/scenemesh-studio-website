# å¿«é€Ÿä¸Šæ‰‹

åœ¨ 15 åˆ†é’Ÿå†…æ„å»ºä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„äº§å“ç®¡ç†åº”ç”¨ï¼Œä½“éªŒ Entity Engine å¦‚ä½•å°†æ•°æ®æ¨¡å‹è‡ªåŠ¨è½¬æ¢ä¸ºå¯äº¤äº’çš„ç”¨æˆ·ç•Œé¢ã€‚

## ä½ å°†æ„å»ºä»€ä¹ˆ

æœ¬æ•™ç¨‹å°†åˆ›å»ºä¸€ä¸ªäº§å“ç®¡ç†ç³»ç»Ÿï¼ŒåŒ…å«ï¼š

- ğŸ“¦ **äº§å“åˆ—è¡¨** - æ˜¾ç¤ºæ‰€æœ‰äº§å“çš„è¡¨æ ¼è§†å›¾ï¼Œæ”¯æŒæœç´¢å’Œç­›é€‰
- â• **æ·»åŠ äº§å“** - æ™ºèƒ½è¡¨å•ï¼ŒåŒ…å«æ•°æ®éªŒè¯å’Œç±»å‹æ£€æŸ¥  
- âœï¸ **ç¼–è¾‘äº§å“** - å†…è”ç¼–è¾‘åŠŸèƒ½
- ğŸ—‘ï¸ **åˆ é™¤äº§å“** - å®‰å…¨çš„åˆ é™¤ç¡®è®¤æµç¨‹

## å¼€å§‹ä¹‹å‰

ç¡®è®¤æ‚¨å·²å®Œæˆä»¥ä¸‹å‡†å¤‡å·¥ä½œï¼š

- âœ… [å®‰è£… Entity Engine](./installation) åŠæ‰€æœ‰ä¾èµ–
- âœ… é…ç½® PostgreSQL æ•°æ®åº“å’Œç¯å¢ƒå˜é‡
- âœ… è¿è¡ŒéªŒè¯è„šæœ¬ç¡®è®¤å®‰è£…æˆåŠŸ

> **ä¿¡æ¯**  
> å¦‚æœæ‚¨æ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨ Entity Engineï¼Œå»ºè®®å…ˆå®Œæˆå®‰è£…æŒ‡å—ä¸­çš„éªŒè¯æ­¥éª¤ã€‚

## æ­¥éª¤ 1ï¼šå®šä¹‰æ•°æ®æ¨¡å‹

æ•°æ®æ¨¡å‹æ˜¯ Entity Engine çš„æ ¸å¿ƒï¼Œå®ƒå®šä¹‰äº†æ•°æ®ç»“æ„å’Œä¸šåŠ¡è§„åˆ™ã€‚

### åˆ›å»ºäº§å“æ¨¡å‹

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `lib/models.ts`ï¼š

```typescript filename="lib/models.ts"
import type { IEntityModel } from '@scenemesh/entity-engine';

export const ProductModel: IEntityModel = {
  name: 'Product',           // æ¨¡å‹åç§°ï¼Œç”¨äºå†…éƒ¨æ ‡è¯†
  title: 'äº§å“',             // æ˜¾ç¤ºåç§°ï¼Œç”¨äºç•Œé¢å±•ç¤º
  fields: [
    {
      name: 'id',
      title: 'ID',
      type: 'string',
      isPrimaryKey: true,     // ä¸»é”®å­—æ®µ
    },
    {
      name: 'name',
      title: 'äº§å“åç§°',
      type: 'string',
      isRequired: true,       // å¿…å¡«å­—æ®µ
      searchable: true,       // æ”¯æŒæœç´¢
    },
    {
      name: 'price',
      title: 'ä»·æ ¼',
      type: 'number',
      isRequired: true,
    },
    {
      name: 'description',
      title: 'äº§å“æè¿°',
      type: 'string',
    }
  ]
};

// å¯¼å‡ºæ‰€æœ‰æ¨¡å‹ä¾›ç³»ç»Ÿä½¿ç”¨
export const models = [ProductModel];
```

### æ¨¡å‹é…ç½®è¯´æ˜

- **name**: æ¨¡å‹çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå¿…é¡»æ˜¯ PascalCase æ ¼å¼
- **title**: ç”¨æˆ·ç•Œé¢ä¸­æ˜¾ç¤ºçš„åç§°
- **fields**: å­—æ®µå®šä¹‰æ•°ç»„ï¼Œæ¯ä¸ªå­—æ®µåŒ…å«ç±»å‹ã€éªŒè¯è§„åˆ™ç­‰é…ç½®
- **isPrimaryKey**: æ ‡è¯†ä¸»é”®å­—æ®µï¼ˆæ¯ä¸ªæ¨¡å‹å¿…é¡»æœ‰ä¸€ä¸ªï¼‰
- **isRequired**: å­—æ®µæ˜¯å¦å¿…å¡«
- **searchable**: å­—æ®µæ˜¯å¦æ”¯æŒå…¨æ–‡æœç´¢

## æ­¥éª¤ 2ï¼šè®¾è®¡ç”¨æˆ·ç•Œé¢

è§†å›¾é…ç½®å†³å®šäº†æ•°æ®å¦‚ä½•åœ¨ç•Œé¢ä¸­å‘ˆç°å’Œäº¤äº’ã€‚

### åˆ›å»ºè§†å›¾é…ç½®

åˆ›å»º `lib/views.ts`ï¼š

```typescript filename="lib/views.ts"
import type { IEntityView } from '@scenemesh/entity-engine';

// åˆ—è¡¨è§†å›¾ï¼šä»¥è¡¨æ ¼å½¢å¼å±•ç¤ºäº§å“
export const ProductGridView: IEntityView = {
  name: 'product_grid',
  title: 'äº§å“åˆ—è¡¨',
  modelName: 'Product',        // å…³è”åˆ° Product æ¨¡å‹
  viewType: 'grid',           // è¡¨æ ¼è§†å›¾ç±»å‹
  items: [
    {
      type: 'field',
      name: 'name',
      spanCols: 4,             // åˆ—å®½æ¯”ä¾‹ï¼ˆæ€»å…±12åˆ—ï¼‰
    },
    {
      type: 'field',
      name: 'price',
      spanCols: 2,
    },
    {
      type: 'field',
      name: 'description',
      spanCols: 6,
    }
  ]
};

// è¡¨å•è§†å›¾ï¼šç”¨äºåˆ›å»ºå’Œç¼–è¾‘äº§å“
export const ProductFormView: IEntityView = {
  name: 'product_form',
  title: 'äº§å“è¡¨å•',
  modelName: 'Product',
  viewType: 'form',           // è¡¨å•è§†å›¾ç±»å‹
  items: [
    {
      type: 'field',
      name: 'name',            // è‡ªåŠ¨ç”Ÿæˆå¯¹åº”çš„è¾“å…¥ç»„ä»¶
    },
    {
      type: 'field',
      name: 'price',           // æ•°å­—ç±»å‹è‡ªåŠ¨ç”Ÿæˆæ•°å­—è¾“å…¥æ¡†
    },
    {
      type: 'field',
      name: 'description',     // å­—ç¬¦ä¸²ç±»å‹è‡ªåŠ¨ç”Ÿæˆæ–‡æœ¬æ¡†
    }
  ]
};

// å¯¼å‡ºæ‰€æœ‰è§†å›¾ä¾›ç³»ç»Ÿä½¿ç”¨
export const views = [ProductGridView, ProductFormView];
```

### è§†å›¾ç±»å‹è¯´æ˜

- **grid**: è¡¨æ ¼è§†å›¾ï¼Œé€‚åˆå±•ç¤ºåˆ—è¡¨æ•°æ®ï¼Œæ”¯æŒæ’åºã€ç­›é€‰ã€åˆ†é¡µ
- **form**: è¡¨å•è§†å›¾ï¼Œé€‚åˆæ•°æ®å½•å…¥å’Œç¼–è¾‘ï¼Œè‡ªåŠ¨ç”Ÿæˆå¯¹åº”çš„è¾“å…¥ç»„ä»¶
- **spanCols**: åœ¨è¡¨æ ¼ä¸­çš„åˆ—å®½å æ¯”ï¼ˆåŸºäº 12 åˆ—æ …æ ¼ç³»ç»Ÿï¼‰

## æ­¥éª¤ 3ï¼šé…ç½®æœåŠ¡ç«¯æ¥å£

Entity Engine éœ€è¦ä¸€ä¸ª API ç«¯ç‚¹æ¥å¤„ç†æ•°æ®æ“ä½œè¯·æ±‚ã€‚

### åˆ›å»º API è·¯ç”±

åœ¨ `app/api/ee/[[...slug]]/route.ts` åˆ›å»ºé€šç”¨ API å¤„ç†å™¨ï¼š

```typescript filename="app/api/ee/[[...slug]]/route.ts"
import { EnginePrimitiveInitializer, fetchEntityEntranceHandler } from '@scenemesh/entity-engine/server';
import { models } from '../../../../lib/models';
import { views } from '../../../../lib/views';

// åˆå§‹åŒ– Entity Engine æœåŠ¡ç«¯å®ä¾‹
const initializer = new EnginePrimitiveInitializer({
  models,                     // ä¼ å…¥æˆ‘ä»¬å®šä¹‰çš„æ¨¡å‹
  views,                      // ä¼ å…¥æˆ‘ä»¬å®šä¹‰çš„è§†å›¾
});

// ç»Ÿä¸€çš„è¯·æ±‚å¤„ç†å™¨ï¼Œæ”¯æŒ GET å’Œ POST
const handler = (req: Request) => 
  fetchEntityEntranceHandler({
    request: req,
    endpoint: '/api/ee',      // API ç«¯ç‚¹è·¯å¾„
    initializer               // ä¼ å…¥åˆå§‹åŒ–å™¨
  });

// å¯¼å‡º HTTP æ–¹æ³•å¤„ç†å™¨
export { handler as GET, handler as POST };
```

## æ­¥éª¤ 4ï¼šé…ç½®å®¢æˆ·ç«¯æä¾›å™¨

å®¢æˆ·ç«¯éœ€è¦ä¸€ä¸ª Provider æ¥è¿æ¥æœåŠ¡ç«¯æ¥å£ã€‚

### åˆ›å»º Provider

åˆ›å»º `lib/entity-provider.tsx`ï¼š

```tsx filename="lib/entity-provider.tsx"
'use client';
import { createEntityEngineProvider } from '@scenemesh/entity-engine';
import { models } from './models';
import { views } from './views';

export const EntityEngineProvider = createEntityEngineProvider({
  config: { models, views },    // å®¢æˆ·ç«¯ä¹Ÿéœ€è¦æ¨¡å‹å’Œè§†å›¾é…ç½®
  settings: {
    baseUrl: process.env.NEXT_PUBLIC_API_BASE_URL || '',
    endpoint: '/api/ee',        // è¿æ¥åˆ°æˆ‘ä»¬åˆšåˆ›å»ºçš„ API ç«¯ç‚¹
    authenticationEnabled: false, // æš‚æ—¶ç¦ç”¨è®¤è¯
  },
  router: {
    navigate: (path: string) => {
      if (typeof window !== 'undefined') {
        window.location.href = path;
      }
    }
  },
  permissionGuard: {
    checkPermission: async () => true, // æš‚æ—¶å…è®¸æ‰€æœ‰æ“ä½œ
  },
});
```

### é…ç½®è¯´æ˜

- **config**: å®¢æˆ·ç«¯éœ€è¦çŸ¥é“æœ‰å“ªäº›æ¨¡å‹å’Œè§†å›¾å¯ç”¨
- **endpoint**: æŒ‡å‘æˆ‘ä»¬åˆšåˆ›å»ºçš„ API è·¯ç”±
- **router**: å¤„ç†é¡µé¢å¯¼èˆªï¼ˆå¯é€‰ï¼‰
- **permissionGuard**: æƒé™æ§åˆ¶ï¼ˆå¯é€‰ï¼Œç”Ÿäº§ç¯å¢ƒä¸­éœ€è¦å®ç°ï¼‰

## æ­¥éª¤ 5ï¼šåˆ›å»ºç”¨æˆ·ç•Œé¢

ç°åœ¨æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„äº§å“ç®¡ç†é¡µé¢ã€‚

### åˆ›å»ºäº§å“ç®¡ç†é¡µé¢

åˆ›å»º `app/products/page.tsx`ï¼š

```tsx filename="app/products/page.tsx"
'use client';
import { EntityViewContainer } from '@scenemesh/entity-engine';
import { EntityEngineProvider } from '../../lib/entity-provider';
import { useState } from 'react';

function ProductsContent() {
  const [showForm, setShowForm] = useState(false);
  const [refreshKey, setRefreshKey] = useState(0);

  return (
    <div className="container mx-auto p-6">
      {/* é¡µé¢æ ‡é¢˜å’Œæ“ä½œæŒ‰é’® */}
      <div className="flex justify-between items-center mb-6">
        <h1 className="text-3xl font-bold">äº§å“ç®¡ç†</h1>
        <button
          onClick={() => setShowForm(!showForm)}
          className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
        >
          {showForm ? 'å–æ¶ˆ' : 'æ–°å¢äº§å“'}
        </button>
      </div>

      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
        {/* äº§å“åˆ—è¡¨ï¼šä½¿ç”¨æˆ‘ä»¬å®šä¹‰çš„ grid è§†å›¾ */}
        <div className={showForm ? 'lg:col-span-2' : 'lg:col-span-3'}>
          <EntityViewContainer
            key={refreshKey}        // ç”¨äºåˆ·æ–°åˆ—è¡¨
            modelName="Product"     // æŒ‡å®šæ¨¡å‹
            viewType="grid"         // æŒ‡å®šè§†å›¾ç±»å‹
            viewName="product_grid" // æŒ‡å®šå…·ä½“è§†å›¾
            behavior={{ mode: 'display' }}
          />
        </div>

        {/* æ–°å¢è¡¨å•ï¼šå½“ç”¨æˆ·ç‚¹å‡»æ–°å¢æ—¶æ˜¾ç¤º */}
        {showForm && (
          <div className="lg:col-span-1">
            <div className="bg-white rounded-lg shadow p-6">
              <h2 className="text-xl font-semibold mb-4">æ–°å¢äº§å“</h2>
              <EntityViewContainer
                modelName="Product"
                viewType="form"
                viewName="product_form"
                behavior={{ mode: 'edit' }}  // ç¼–è¾‘æ¨¡å¼
                callbacks={{
                  onSaved: () => {
                    setShowForm(false);      // ä¿å­˜åå…³é—­è¡¨å•
                    setRefreshKey(prev => prev + 1); // åˆ·æ–°åˆ—è¡¨
                  },
                  onCancelled: () => {
                    setShowForm(false);      // å–æ¶ˆæ—¶å…³é—­è¡¨å•
                  }
                }}
              />
            </div>
          </div>
        )}
      </div>
    </div>
  );
}

export default function ProductsPage() {
  return (
    <EntityEngineProvider>
      <ProductsContent />
    </EntityEngineProvider>
  );
}
```

## æ­¥éª¤ 6ï¼šé…ç½®åº”ç”¨å¸ƒå±€

æ›´æ–°åº”ç”¨æ ¹å¸ƒå±€ä»¥æ”¯æŒ Entity Engine çš„ UI ç»„ä»¶ã€‚

### æ›´æ–°æ ¹å¸ƒå±€

ä¿®æ”¹ `app/layout.tsx` å¯¼å…¥å¿…è¦çš„æ ·å¼å’Œ Providerï¼š

```tsx filename="app/layout.tsx"
import '@scenemesh/entity-engine/main.css';
import '@mantine/core/styles.css';
import '@mantine/notifications/styles.css';
import '@mantine/modals/styles.css';
import 'mantine-datatable/styles.css';
import { MantineProvider } from '@mantine/core';
import { Notifications } from '@mantine/notifications';

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="zh">
      <body>
        <MantineProvider>
          <Notifications />
          {children}
        </MantineProvider>
      </body>
    </html>
  );
}
```

### é…ç½®è¯´æ˜

- **MantineProvider**: Entity Engine ä½¿ç”¨ Mantine ç»„ä»¶åº“ï¼Œéœ€è¦åœ¨åº”ç”¨æ ¹éƒ¨åŒ…è£…
- **Notifications**: æä¾›æ“ä½œæˆåŠŸ/å¤±è´¥çš„æç¤ºåŠŸèƒ½
- **æ ·å¼å¯¼å…¥**: æŒ‰æ­£ç¡®é¡ºåºå¯¼å…¥æ‰€æœ‰å¿…éœ€çš„ CSS æ–‡ä»¶

## è¿è¡Œå’Œæµ‹è¯•

### å¯åŠ¨åº”ç”¨

ç°åœ¨å¯åŠ¨å¼€å‘æœåŠ¡å™¨æŸ¥çœ‹æ‚¨çš„äº§å“ç®¡ç†åº”ç”¨ï¼š

```bash
npm run dev
```

åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼šhttp://localhost:3000/products

### åº”ç”¨åŠŸèƒ½

æ‚¨çš„åº”ç”¨ç°åœ¨å…·å¤‡å®Œæ•´çš„ CRUD åŠŸèƒ½ï¼š

- âœ… **äº§å“åˆ—è¡¨** - ä»¥è¡¨æ ¼å½¢å¼å±•ç¤ºæ‰€æœ‰äº§å“
- âœ… **æ·»åŠ äº§å“** - ç‚¹å‡»"æ–°å¢äº§å“"æ‰“å¼€è¡¨å•ï¼Œå¡«å†™ä¿¡æ¯å¹¶ä¿å­˜
- âœ… **æ•°æ®éªŒè¯** - è‡ªåŠ¨éªŒè¯å¿…å¡«å­—æ®µï¼ˆäº§å“åç§°å’Œä»·æ ¼ï¼‰
- âœ… **å®æ—¶æ›´æ–°** - æ·»åŠ äº§å“ååˆ—è¡¨è‡ªåŠ¨åˆ·æ–°æ˜¾ç¤ºæ–°æ•°æ®

### å°è¯•æ“ä½œ

1. **æ·»åŠ äº§å“**: ç‚¹å‡»"æ–°å¢äº§å“"æŒ‰é’®ï¼Œå¡«å†™äº§å“ä¿¡æ¯å¹¶ä¿å­˜
2. **æŸ¥çœ‹åˆ—è¡¨**: æ–°æ·»åŠ çš„äº§å“ä¼šç«‹å³æ˜¾ç¤ºåœ¨åˆ—è¡¨ä¸­
3. **éªŒè¯åŠŸèƒ½**: å°è¯•æäº¤ç©ºè¡¨å•ï¼ŒæŸ¥çœ‹éªŒè¯æç¤º

## æ ¸å¿ƒæ¦‚å¿µå›é¡¾

é€šè¿‡è¿™ä¸ªå¿«é€Ÿæ•™ç¨‹ï¼Œæ‚¨å·²ç»å­¦ä¼šäº†ï¼š

### æ•°æ®å»ºæ¨¡
- ä½¿ç”¨ `IEntityModel` å®šä¹‰æ•°æ®ç»“æ„
- é…ç½®å­—æ®µç±»å‹ã€éªŒè¯è§„åˆ™å’Œæ˜¾ç¤ºå±æ€§

### ç•Œé¢è®¾è®¡
- ä½¿ç”¨ `IEntityView` å®šä¹‰ç”¨æˆ·ç•Œé¢å¸ƒå±€
- åŒºåˆ† `grid`ï¼ˆåˆ—è¡¨ï¼‰å’Œ `form`ï¼ˆè¡¨å•ï¼‰è§†å›¾ç±»å‹

### ç³»ç»Ÿé›†æˆ
- é…ç½®æœåŠ¡ç«¯ API å¤„ç†å™¨
- è®¾ç½®å®¢æˆ·ç«¯ Provider è¿æ¥
- ä½¿ç”¨ `EntityViewContainer` æ¸²æŸ“ç•Œé¢

## è¿›é˜¶æ‰©å±•

### æ·»åŠ æ›´å¤šå­—æ®µç±»å‹

```typescript filename="lib/models.ts" highlight="4-17"
// åœ¨ ProductModel.fields ä¸­æ·»åŠ 
{
  name: 'category',
  title: 'äº§å“åˆ†ç±»',
  type: 'enum',               // æšä¸¾ç±»å‹ï¼ˆä¸‹æ‹‰é€‰æ‹©ï¼‰
  typeOptions: {
    options: [
      { value: 'electronics', label: 'ç”µå­äº§å“' },
      { value: 'clothing', label: 'æœè£…' },
      { value: 'books', label: 'å›¾ä¹¦' }
    ]
  }
},
{
  name: 'inStock',
  title: 'æœ‰åº“å­˜',
  type: 'boolean',            // å¸ƒå°”ç±»å‹ï¼ˆå¼€å…³ï¼‰
  defaultValue: true
}
```

### å¯ç”¨æœç´¢å’Œç­›é€‰

```typescript filename="lib/views.ts" highlight="6-8"
export const ProductGridView: IEntityView = {
  name: 'product_grid',
  title: 'äº§å“åˆ—è¡¨',
  modelName: 'Product',
  viewType: 'grid',
  searchFields: ['name', 'description'],    // å¯ç”¨å…¨æ–‡æœç´¢
  filters: ['category', 'inStock'],         // æ·»åŠ ç­›é€‰å™¨
  sorting: { field: 'name', direction: 'asc' }, // è®¾ç½®é»˜è®¤æ’åº
  items: [
    // ... å­—æ®µé…ç½®
  ]
};
```

## ä¸‹ä¸€æ­¥å­¦ä¹ 

ğŸ‰ **æ­å–œï¼** æ‚¨å·²ç»æŒæ¡äº† Entity Engine çš„åŸºç¡€ç”¨æ³•ã€‚æ¥ä¸‹æ¥å¯ä»¥ï¼š

1. **[æ·±å…¥å­¦ä¹ é¡¹ç›®ç»“æ„](./project-structure)** - äº†è§£å¦‚ä½•ç»„ç»‡å¤§å‹åº”ç”¨
2. **[æ„å»ºå®Œæ•´ä¸šåŠ¡åŠŸèƒ½](./first-model-and-view)** - å­¦ä¹ å…³è”å…³ç³»ã€é«˜çº§éªŒè¯ç­‰
3. **[æ¢ç´¢é«˜çº§ç‰¹æ€§](./config-runtime-load)** - åŠ¨æ€é…ç½®ã€å¤šç§Ÿæˆ·ç­‰ä¼ä¸šç‰¹æ€§

### é‡åˆ°é—®é¢˜ï¼Ÿ

- ğŸ“– [å¸¸è§é—®é¢˜è§£ç­”](./faq-beginner) - è§£å†³å¸¸è§çš„é…ç½®å’Œä½¿ç”¨é—®é¢˜
- ğŸ’¬ [ç¤¾åŒºè®¨è®º](https://github.com/scenemesh/entity-engine/discussions) - ä¸å…¶ä»–å¼€å‘è€…äº¤æµ
- ğŸ› [åé¦ˆé—®é¢˜](https://github.com/scenemesh/entity-engine/issues) - æŠ¥å‘Š Bug æˆ–å»ºè®®æ–°åŠŸèƒ½